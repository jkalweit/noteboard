<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="float-drawer.html">
<link rel="import" href="nb-note.html">

<polymer-element name="nb-app" attributes="notes">
    <template>
        <style>
            :host {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                min-height: 100%;
                background-color: #CCCCCC;
            }
        </style>

        <float-drawer keep="false" isopen="false">
            <div style="width: 250px;">
                <h1>Notes</h1>
                <paper-button icon="save" label="Save" on-click="{{save}}"></paper-button><br/>
                <paper-button icon="add" label="Add Note" on-click="{{addNote}}"></paper-button><br/>
                <paper-button icon="undo" label="Load Demo" on-click="{{loadDemo}}"></paper-button><br/>
            </div>
        </float-drawer>


        <template repeat="{{note in notes.list}}">
            <nb-note note="{{note}}" on-delete-note="{{deleteNote}}"></nb-note>
        </template>

    </template>
    <script>
        Polymer('nb-app', {
            ready: function () {
                this.load();
            },
            save: function () {
                localStorage.setItem('notes', JSON.stringify(this.notes));
            },
            load: function () {
                var d = localStorage.getItem('notes');
                this.jsonText = d;
                if (d !== null)
                    this.notes = JSON.parse(d);
                else
                    this.notes = {
                        currId: 0,
                        list: []
                    }
            },
            addNote: function () {
                this.notes.list.push({
                    id: ++this.notes.currId,
                    list: []
                });
            },
            deleteNote: function (e, detail) {
                for(var i = 0; i < this.notes.list.length; i++) {
                    if(this.notes.list[i].id == detail.id){
                        this.notes.list.splice(i, 1);
                        return;
                    }
                }
            },
            loadDemo: function () {
                this.notes = {
                    currId: 3,
                    list: [
                        {
                            id: 1,
                            title: 'Note 1',
                            items: [
                                { text: 'This is item 1' },
                                { text: 'This is item 2' },
                                { text: 'This is item 3' }
                            ]
                        },
                        {
                            id: 2,
                            title: 'Note 2',
                            items: [
                                { text: 'This is item 1' },
                                { text: 'This is item 2' },
                                { text: 'This is item 3' }
                            ]
                        },
                        {
                            id: 3,
                            title: 'Note 3',
                            items: [
                                { text: 'This is item 1' },
                                { text: 'This is item 2' },
                                { text: 'This is item 3' }
                            ]
                        }
                    ]
                };
            }

        });
    </script>
</polymer-element>